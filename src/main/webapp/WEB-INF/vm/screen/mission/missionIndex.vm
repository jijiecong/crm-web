##sumoselect
<link href="$formLink/admin/media/css/sumoselect.css" rel="stylesheet">
<script src="$formLink/admin/media/js/jquery.sumoselect.min.js"></script>

<link href="$formLink/admin/media/css/bosco/list.css"
      rel="stylesheet" type="text/css">
<link href="$formLink/admin/media/css/jquery.mCustomScrollbar.css"
      rel="stylesheet" type="text/css">
<link href="$formLink/admin/media/css/bootstrap-select.min.css" rel="stylesheet" type="text/css">

<script src="${formLink}/admin/media/js/bootstrap-select.js"></script>
<link href="$formLink/admin/media/js/need/laydate.css" rel="stylesheet" media="screen" type="text/css">
<link href="$formLink/admin/media/js/skins/default/laydate.css" rel="stylesheet" media="screen" type="text/css">
<script src="$formLink/admin/media/js/laydate.js"></script>

##emoji
<link href="$formLink/admin/media/css/emojione.min.css" rel="stylesheet">
<script src="$formLink/admin/media/js/emojione.min.js"></script>

<script src="${formLink}/admin/static/js/sea-modules/seajs/2.2.1/sea.js"></script>
<script src="${formLink}/admin/static/js/app/seajs/config-seajs.js"></script>

<style type="text/css">
    .u-tips {
        display: none;
        position: fixed;
        height: auto;
        z-index: 99999;
        left: 50%;
        top: 50%;
        width: 236px;
        margin-left: -118px;
        padding: 8px;
        line-height: 24px;
        border-radius: 4px;
        background-color: rgba(0, 0, 0, .6);
        text-align: center;
        font-size: 20px;
        color: #fff;
        font-size: 1.4rem;
    }

</style>

<div class="page-content">

    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span12">
                <h3 class="page-title">任务列表</h3>
                <span>$!message</span>
            </div>
        </div>
        <div class="row-fluid margin-bottom-20 content-area">
        <div class="span12 list-action-top-area">
            <form id="mission_index_form" class="form-horizontal listSearchBox" action="/mission/missionIndex" method="post">
                <div class="span12">
                    <span class="help-inline">任务ID：</span>
                    <input type="text" class="m-wrap small" name="missionIdSearch" id="missionIdSearch" value="$!missionIdSearch">
                    <span class="help-inline">任务名称：</span>
                    <input type="text" class="m-wrap small" name="missionNameSearch" id="missionNameSearch" value="$!missionNameSearch">
                    <span class="help-inline">开始时间：</span>
                    <input type="text" class="m-wrap small laydate-icon" name="missionStartTimeSearch" id="missionStartTimeSearch"  value="$!missionStartTimeSearch">
                    <span class="help-inline">结束时间：</span>
                    <input type="text" class="m-wrap small laydate-icon" name="missionEndTimeSearch" id="missionEndTimeSearch" value="$!missionEndTimeSearch">
                    <span class="help-inline">创建时间：</span>
                    <input type="text" class="m-wrap small laydate-icon" name="missionCreateStartTimeSearch" id="missionCreateStartTimeSearch"  value="$!missionCreateStartTimeSearch">
                    <span class="help-inline">至</span>
                    <input type="text" class="m-wrap small laydate-icon" name="missionCreateEndTimeSearch" id="missionCreateEndTimeSearch"  value="$!missionCreateEndTimeSearch">
##                    <br>
                    <div style="margin-top: 5px">
                    <span >排序方式</span>
                    <select name="sortSearch" class="select_input" id="sort_input">
                        <option value=1
                            #if($!sortSearch==1)
                                selected="selected"
                            #end
                        >添加时间倒序
                        </option>
                        <option value=2
                            #if($!sortSearch==2)
                                selected="selected"
                            #end
                        >添加时间顺序
                        </option>
                        <option value=3
                            #if($!sortSearch==3)
                                selected="selected"
                            #end
                        >开始时间倒序
                        </option>
                        <option value=4
                            #if($!sortSearch==4)
                                selected="selected"
                            #end
                        >开始时间顺序
                        </option>
                    </select>
##                    隐藏的输入框，存储表格里的选择
                    <input id="state_input_hidden" name="stateSearch" value="$!stateSearch" type="hidden" class="hiddenInput" selectId="state_select"></input>
                    <input id="type_input_hidden" name="typeSearch" value="$!typeSearch" type="hidden" class="hiddenInput" selectId="type_select"></input>
                    <input id="channel_input_hidden" name="channelSearch" value="$!channelSearch" type="hidden" class="hiddenInput" selectId="channel_select"></input>
                    <input id="create_user_input_hidden" name="createUserSearch" value="$!createUserSearch" type="hidden" ></input>
                    <button id="mission_index_submit_button" type="submit" class="btn blue search-btn">查 询</button>
                </div>
                </div>
            </form>

        <div class="portlet box green">
            <div class="portlet-title">
                <div class="caption">
                    <i class="icon-cogs"></i>
                    任务列表
                </div>
            </div>

            <div class="portlet-body">
                <table class="table table-condensed table-hover" >
                    <colgroup>
##                        任务ID
                        <col style="width: 5%">
##                          任务名称
                        <col style="width: 7%">
##                          任务状态
                        <col style="width: 9%">
##                          任务类型
                        <col style="width: 9%">
##                          开始时间
                        <col style="width: 8%">
##                          结束时间
                        <col style="width: 8%">
##                          投放渠道
                        <col style="width: 10%">
##                          创建时间
                        <col style="width: 10%">
##                          创建人
                        <col style="width: 10%">
##                          操作人
                        <col style="width: 8%">
##                          操作时间
                        <col style="width: 8%">
##                          操作
                        <col style="width: 8%">
                    </colgroup>
                    <thead>
                    <tr>
                        <th style="text-align: center">任务ID</th>
                        <th style="text-align: center">任务名称</th>
                        ##    任务状态
                        <th style="text-align: center">
                                <select id="state_select" class="SumoSelect" inputId="state_input_hidden"  multiple="multiple" style="border: none;width: 90%;height: 0">
                                    <option value="1">待上架</option>
                                    <option value="3">已上架</option>
                                    <option value="6">已下架</option>
                                </select>

                        </th>
                        ##    任务类型
                        <th style="text-align: center">
                            <select id="type_select" class="SumoSelect" inputId="type_input_hidden"  multiple="multiple" style="border: none;width: 90%;height: 0">
                                #foreach($type in $!totalTypes)
                                <option  value="$!type.typeName">$!type.typeNameDesc</option>
                                #end
                            </select>
                        </th>
                        <th style="text-align: center">开始时间</th>
                        <th style="text-align: center">结束时间</th>
                        ##    投放渠道
                        <th style="text-align: center">
                            <select id="channel_select" class="SumoSelect" inputId="channel_input_hidden"  multiple="multiple" style="border: none;width: 90%;height: 0">
                                #foreach($channel in $!totalChannels)
                                    <option  value="$!channel.id">$!channel.channelName</option>
                                #end
                            </select>
                        </th>
                        <th style="text-align: center">创建时间</th>
                        ##   创建人
                        <th style="text-align: center">
                            <select id="create_user_select" class="SumoSelect" inputId="create_user_input_hidden"  multiple="multiple" style="border: none;width: 90%;height: 0px">
                            </select>
                        </th>
                        <th style="text-align: center">操作人</th>
                        <th style="text-align: center">操作时间</th>
                        <th style="text-align: center">操作</th>
                    </tr>
                    </thead>
                    <tbody>
                        #foreach($basicVO in $basicVOList)
                        <tr class="u_$!basicVO.id" data-uid="$!basicVO.id">
##                            <td><input type="checkbox" name="mission_id" class="list-checkbox" value="$!basicVO.id"></td>
                            <td style="text-align: center" >$!basicVO.id</td>
                            <td style="text-align: center" class="emoji"><a href="/mission/missionGlobalDetail?id=$basicVO.id" >$!basicVO.missionName</a></td>
                            <td style="text-align: center">
                                #if($!basicVO.state==1)
                                待上架
                                #elseif($!basicVO.state==3)
                                已上架
                                #elseif($!basicVO.state==6)
                                已下架
                                #else
                                未知状态
                                #end
                            </td>
##                            转换成中文
                            <td style="text-align: center">$!basicVO.missionType</td>
                            <td style="text-align: center">$dateUtils.format($!basicVO.beginTime,"yyyy-MM-dd HH:mm:ss")</td>
                            <td style="text-align: center">$dateUtils.format($!basicVO.endTime,"yyyy-MM-dd HH:mm:ss")</td>
                            <td data-uid="$!basicVO.id" style="text-align: center" >
##                                #foreach($channelVO in $!basicVO.channelVOList)
##                                $!channelVO.channelName
##                                #end
                                $!basicVO.channelIdsDesc
                            </td>
                            <td style="text-align: center">$dateUtils.format($!basicVO.gmtCreated,"yyyy-MM-dd HH:mm:ss")</td>
                            <td style="text-align: center">$!basicVO.createUserName</td>
                            <td style="text-align: center">$!basicVO.operateUserName</td>
                            <td style="text-align: center">$dateUtils.format($!basicVO.gmtModified,"yyyy-MM-dd HH:mm:ss")</td>
##                            <td >$!basicVO.userName</td>

                            <td data-uid="$!basicVO.id" style="text-align: center">
                                <div class="btn-group">

                                    <a class="btn mini purple " onclick="missionQRCode(this);"  data-toggle="modal" data-uid="$!basicVO.id" >
                                        预览
                                    </a>
                                </div>

                                        #if($!basicVO.state==6 || $!basicVO.state==1)
                                        <div class="btn-group">
                                            <a href="#mission_online__div" data-toggle="modal"
                                               class="btn mini red edit online-offline"  style="margin-left: 3px;" data-uid="$!basicVO.id">
                                                上架
                                            </a>
                                        </div>
                                        #elseif($!basicVO.state==3)
                                        <div class="btn-group">
                                            <a href="#mission_offline__div"  data-toggle="modal"
                                               class="btn mini red edit online-offline"  style="margin-left: 3px;" data-uid="$!basicVO.id">
                                                下架
                                            </a>
                                        </div>
                                    #end
                            </td>
                        </tr>
                        #end
                    </tbody>
                </table>
            </div>
        </div>
        #if ($totalCount > 0)
            <div class="pages" style="padding:3px">
                #set($cpage = $pageUtil.pager($curPage, $pageSize, $totalCount))
				        #set($url = $formLink.setTarget('/mission/missionIndex').addQueryData('missionIdSearch',  "$!missionIdSearch").addQueryData('missionNameSearch',  "$!missionNameSearch").addQueryData('missionStartTimeSearch',"$!missionStartTimeSearch").addQueryData('missionEndTimeSearch',"$!missionEndTimeSearch").addQueryData('missionCreateStartTimeSearch',"$!missionCreateStartTimeSearch").addQueryData('missionCreateEndTimeSearch',"$!missionCreateEndTimeSearch").addQueryData('stateSearch',"$!stateSearch").addQueryData("typeSearch",$!typeSearch).addQueryData("channelSearch",$!channelSearch).addQueryData("createUserSearch",$!createUserSearch).addQueryData('sortSearch',"$!sortSearch").fork())
				   		#showPage($cpage $url)
            </div>
        #end
    </div>
</div>


<div id="mission_online__div" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel1" aria-hidden="true">
    <h3>确认上架任务?</h3>
    <form  class="form-horizontal listSearchBox" method="post">

        <div>
            <button id="mission_online_submit" class="btn yellow submit" value="" style="margin-left: 80%">确 认</button>
        </div>
    </form>
</div>

<div id="mission_offline__div" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel1" aria-hidden="true">
    <h3>确认下架任务?</h3>
    <form  class="form-horizontal listSearchBox" method="post">

        <div>
            <button id="mission_offline_submit" class="btn yellow submit" style="margin-left: 80%">确 认</button>
        </div>
    </form>
</div>

        <input type="hidden" id="selectedBasicRegion"/>
<script src="$formLink/admin/static/app/mission/missionIndex.js"></script>
<script>

/**
 * ATTENTION 要先给上次选择的option加上selected属性 然后再让sumoselect插件解析option 这样才能实现preselect效果 坑爹啊
 */
$(document).ready(function (){
    preSelect();
    initSumoselect();
    handleEmoji();
    initCreateUsers();


});


/**
 *初始化时间选择控件
 */
var start = {
    elem: '#missionStartTimeSearch',
    format: 'YYYY-MM-DD hh:mm:ss',
    max: '2099-06-16 23:59:59', //最大日期
    istime: true,
    istoday: true,
    choose: function(datas){
        end.min = datas; //开始日选好后，重置结束日的最小日期
        end.start = datas //将结束日的初始值设定为开始日
    }
};
var end = {
    elem: '#missionEndTimeSearch',
    format: 'YYYY-MM-DD hh:mm:ss',
    max: '2099-06-16 23:59:59',
    istime: true,
    istoday: false,
    choose: function(datas){
        start.max = datas; //结束日选好后，重置开始日的最大日期
    }
};
laydate(start);
laydate(end);
var start2 = {
    elem: '#missionCreateStartTimeSearch',
    format: 'YYYY-MM-DD hh:mm:ss',
    max: '2099-06-16 23:59:59', //最大日期
    istime: true,
    istoday: true,
    choose: function(datas){
        end2.min = datas; //开始日选好后，重置结束日的最小日期
        end2.start = datas //将结束日的初始值设定为开始日
    }
};
var end2 = {
    elem: '#missionCreateEndTimeSearch',
    format: 'YYYY-MM-DD hh:mm:ss',
    max: '2099-06-16 23:59:59',
    istime: true,
    istoday: false,
    choose: function(datas){
        start2.max = datas; //结束日选好后，重置开始日的最大日期
    }
};
laydate(start2);
laydate(end2);

</script>

