<link href="$formLink/admin/media/css/bosco/list.css"
      rel="stylesheet" type="text/css">
<link href="$formLink/admin/media/css/jquery.mCustomScrollbar.css"
      rel="stylesheet" type="text/css">
<link href="$formLink/admin/media/css/bootstrap-select.min.css" rel="stylesheet" type="text/css">

<script src="${formLink}/admin/media/js/bootstrap-select.js"></script>


<script src="${formLink}/admin/media/js/bootstrap-datetimepicker.js"></script>
<script src="${formLink}/admin/media/js/bootstrap-select.js"></script>
<script src="${formLink}/admin/media/js/moment.js"></script>


<script src="$formLink/admin/media/js/ui-nestable.js"></script>
<script src="$formLink/admin/media/js/chosen.jquery.min.js" type="text/javascript"></script>
<script src="$formLink/admin/media/js/app.js"></script>
<script src="$formLink/admin/media/js/form-components.js"></script>


<link href="$formLink/admin/media/css/bosco/list.css"
      rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="${formLink}/admin/media/css/datepicker.css">
<!-- Bootstrap styles -->
<link rel="stylesheet" href="${formLink}/admin/media/upload/css/bootstrap.min.css">
<!-- Generic page styles -->
<link rel="stylesheet" href="${formLink}/admin/media/upload/css/style.css">
<!-- blueimp Gallery styles -->
<link rel="stylesheet" href="${formLink}/admin/media/upload/css/blueimp-gallery.min.css">
<!-- CSS to style the file input field as button and adjust the Bootstrap progress bars -->
<link rel="stylesheet" href="${formLink}/admin/media/upload/css/jquery.fileupload.css">
<link rel="stylesheet" href="${formLink}/admin/media/upload/css/jquery.fileupload-ui.css">
<!-- CSS adjustments for browsers with JavaScript disabled -->
<noscript>
    <link rel="stylesheet" href="${formLink}/admin/media/upload/css/jquery.fileupload-noscript.css">
</noscript>
<noscript>
    <link rel="stylesheet" href="${formLink}/admin/media/upload/css/jquery.fileupload-ui-noscript.css">
</noscript>
##<script src="${formLink}/admin/media/upload/js/jquery.min.js"></script>
<!-- The jQuery UI widget factory, can be omitted if jQuery UI is already included -->
<script src="${formLink}/admin/media/upload/js/vendor/jquery.ui.widget.js"></script>
<!-- The Templates plugin is included to render the upload/download listings -->
<script src="${formLink}/admin/media/upload/js/tmpl.min.js"></script>
<!-- The Load Image plugin is included for the preview images and image resizing functionality -->
<script src="${formLink}/admin/media/upload/js/load-image.all.min.js"></script>
<!-- The Canvas to Blob plugin is included for image resizing functionality -->
<script src="${formLink}/admin/media/upload/js/canvas-to-blob.min.js"></script>
<!-- Bootstrap JS is not required, but included for the responsive demo navigation -->
<script src="${formLink}/admin/media/upload/js/bootstrap.min.js"></script>
<!-- blueimp Gallery script -->
<script src="${formLink}/admin/media/upload/js/jquery.blueimp-gallery.min.js"></script>
<!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
<script src="${formLink}/admin/media/upload/js/jquery.iframe-transport.js"></script>
<!-- The basic File Upload plugin -->
<script src="${formLink}/admin/media/upload/js/jquery.fileupload.js"></script>
<!-- The File Upload processing plugin -->
<script src="${formLink}/admin/media/upload/js/jquery.fileupload-process.js"></script>
<!-- The File Upload image preview & resize plugin -->
<script src="${formLink}/admin/media/upload/js/jquery.fileupload-image.js"></script>
<!-- The File Upload audio preview plugin -->
<script src="${formLink}/admin/media/upload/js/jquery.fileupload-audio.js"></script>
<!-- The File Upload video preview plugin -->
<script src="${formLink}/admin/media/upload/js/jquery.fileupload-video.js"></script>
<!-- The File Upload validation plugin -->
<script src="${formLink}/admin/media/upload/js/jquery.fileupload-validate.js"></script>
<!-- The File Upload user interface plugin -->
<script src="${formLink}/admin/media/upload/js/jquery.fileupload-ui.js"></script>
<!-- The main application script -->
<script src="${formLink}/admin/media/upload/js/mainTemplate.js"></script>
<style type="text/css">
.div_left{
    float: left;
    width:570px;

    margin-left: 32px;

}
.div_right{
    float: left;
    width:300px;
    margin-left: 5px;
}
.div_left_img,.div_right_img{
    float: left;
    width: 580px;

    height: 350px;
    margin-top: 5px;
}
    .div_frame, .div_frame_2 {
        margin-left: 10px;
        margin-bottom: 15px;
        float: left;

    }

    .div_frame_2 {
        width: 420px;
    }

    .div_frame_1 {
        float: left;
        width: 100px;

    }
.button_cancel{
    width: 41px;
    height:41px;
    border-radius: 20px; /* font-size: 10px;*/
    background-image:url('${formLink}/admin/media/upload/img/cancel.png');
    border:none;
    outline:none;
    position: absolute;
    margin-top: -88%;
    margin-left: 66%;
    background-color: transparent;
    background-size:cover;
}
    .button_add{
        width: 42px;
        height:41px;
        border-radius: 20px; /* font-size: 10px;*/
        background-image:url('${formLink}/admin/media/upload/img/add.png');
        border:none;
        outline:none;
        background-color: transparent;
        background-size:cover;
    }
    #wrap {
        position: relative;
        display: inline-block;
    }
/*a  upload */
.a-upload {
    padding: 4px 10px;
    height: 30px;
    line-height: 20px;
    position: relative;
    cursor: pointer;
    color: #888;
    background: #fafafa;
    border: 1px solid #ddd;
    border-radius: 4px;
    overflow: hidden;
    display: inline-block;
    *display: inline;
    *zoom: 1
}

.a-upload  input {
    position: absolute;
    font-size: 100px;
    right: 0;
    top: 0;
    opacity: 0;
    filter: alpha(opacity=0);
    cursor: pointer
}

.a-upload:hover {
    color: #444;
    background: #eee;
    border-color: #ccc;
    text-decoration: none
}

</style>

<div class="page-content">
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span12">
                <h3 class="page-title">任务添加</h3>

                <span>$!message</span>
            </div>
        </div>
        <div style="margin-top: 0;margin-left:0;width: 550px;clear: both;height: 20px">
            <ul style="list-style-type:none">
                <li style="border: solid 1px #ABABAB;float:left;width:150px;text-align: center;background-color:#ABABAB;">

                        <span style="color: white ;">
                                 1.填写基本任务信息
                            </span>
                </li>
                <li style="border: solid 1px #ABABAB;float:left;background-color:#ABABAB;width:150px;text-align: center">
                <span style="color: white;">
                                 2.完善任务详情
                            </span>
                </li>
                <li style="border: solid 1px #666666;float:left;background-color:#666666;width:150px;text-align: center">


            <span style="color: white ;">
                                     3.配置H5页面
                            </span>
                </li>
            </ul>
        </div>
        <div class="span12 list-action-top-area">

        </div>


        <!--任务信息-->
        <div style="width: 1000px;border:1 solid black;text-align: left;margin-top: 5px">

<div class="div_left" style="margin-bottom: 0px">
            <div class="div_frame">
                <div ReadOnly="true" class="div_frame_1">H5页面标题：</div>
                <div class="div_frame_2" style="margin-bottom: 0px"><input type="text" maxlength="${templateTitleLimit}" onchange="titleJudge()" id="textarea_html_title"
                                                class="input-top" value="$!config.title"
                                                style="border:1px solid;border-color:rgba(82,168,236,.8);width: 200px;height: 30px;margin-left: 5px"/>
                    <span id="title_desc" style="color: grey;margin-left: 3px;"></span>

            </div>


            </div>


            <div class="div_frame" style="margin-bottom: 0px">
                <div ReadOnly="true" class="div_frame_1">模板类型：</div>
                <div class="div_frame_2" style="margin-left: 16px;margin-bottom: 0px">

                    #foreach($template in $!templateList)
                        #set($judge=1)
                        <div>
                            <input type="radio" id="$template.id" name="template"
                                #if($template.id==1)
                                   checked="checked"
                                #end

                                   value="$template.id" >$template.templateName

                            <span id="" style="color: grey;margin-left: 3px;">建议尺寸宽（1024）X高（<=1536)；大小<500K</span>
                        </div>

                    #end
#if($!judge!=1)
    所有模板均被禁用，请联系管理员。
#end

                #*上传图片开始*#
                    <script id="template-upload" type="text/x-tmpl">
                    {% for (var i=0, file; file=o.files[i]; i++) { %}
                        <tr class="template-upload fade" style="display: none">
                          <td>
                             <span class="preview"></span>
                           </td>

                            <td>
                                {% if (!i && !o.options.autoUpload) { %}
                                <button id="123" class="btn btn-primary start" disabled>
                                    <span>开始上传</span>
                                 </button>
                                {% } %}
                           {% if (!i) { %}
                            <button class="btn btn-warning cancel">
                               <span>取消上传</span>
                           </button>
                          {% } %}
                         </td>
                         </tr>
                        {% } %}

                    </script>
                    <!-- The template to display files available for download -->
                    <script id="template-download" type="text/x-tmpl">
                        {% for (var i=0, file; file=o.files[i]; i++) { %}
                            <tr class="template-download fade">
                            <td  id="wrap" style="height: 266px">
                            <span class="preview">
                             {% if (!file.url) { %}
                                <span style="color:black">    上传失败！请删除</br>后重新上传。</span>
                                {% } %}
                                {% if (file.url) { %}
                            <a href="{%=file.url%}" name="htmlImages" title="{%=file.name%}" download="{%=file.name%}" data-gallery data-id="1"><img src="{%=file.thumbnailUrl%}" style="width:160px;max-height:266px"></a>
                                            {% } %}
            </span>

 <a href="{%=file.url%}" name="htmlImages" title="{%=file.name%}" download="{%=file.name%}" data-gallery></a>
                 <button class="button_cancel cancel" >

                </button>

        </td>
    </tr>
{% } %}











                    </script>
                    <div  style="width: 250px;overflow-y:scroll;height:310px;border: 1px solid gainsboro;background-color: ;">
                        <div class="container-fluid" >

                            <div class="row-fluid" margin-bottom-20 content-area" >

                            <div class="portlet box " >
                                <div class="portlet-title" >
                                    <br>
                                    <!-- The file upload form used as target for the file upload widget -->
                                    <form id="fileupload" action="/pic/templatePic" method="POST"
                                          enctype="multipart/form-data">
                                        <!-- Redirect browsers with JavaScript disabled to the origin page -->
                                        <noscript><input type="hidden" name="redirect"
                                                         value="https://blueimp.github.io/jQuery-File-Upload/">
                                        </noscript>
                                        <!-- The fileupload-buttonbar contains buttons to add/delete files and start/cancel the upload -->

                                        <!-- The table listing the files available for upload/download -->
                                        <table role="presentation" class="table table-striped" id="table">
                                            <tbody class="files">
                                            #foreach($pic in $!picList)

                                            <tr class="template-download fade in" >
                                                <td  id="wrap" style="height: 266px">
                                                    <span class="preview">

                                                        <a href="$pic" name="htmlImages"  data-gallery data-id="1">
                                                            <img src="$pic"  style="width:160px;max-height:266px"/></a>  </span>
                                                        <a href="$pic" name="htmlImages"  data-gallery ></a>
                                                    <button class="button_cancel cancel"  >
                                                    </button>

                                                </td>
                                            </tr>

                                            #end
                                            </tbody>
                                        </table>
                                        <div class="row fileupload-buttonbar">
                                            <div class="col-lg-7">
                                                <!-- The fileinput-button span is used to style the file input field as button -->
                                                <span class="button_add fileinput-button">
                                                <span></span>
                                                <input type="file" name="files"  accept="image/gif, image/jpeg,image/png" onchange="upperCase()" >
                                                 </span>
                                            #*<button type="submit" class="btn btn-primary start">
                                                <span>上传文件</span>
                                            </button>
                                            <button type="reset" class="btn btn-warning cancel">
                                                <span>取消上传</span>
                                            </button>*#
                                                <button type="button" class="btn btn-danger delete"
                                                        style="display: none">
                                                    <span>Delete</span>
                                                </button>
                                            ##                            <input type="checkbox" class="toggle">
                                                <!-- The global file processing state -->
                                                <span class="fileupload-process green"></span>
                                            </div>
                                            <!-- The global progress state -->

                                        </div>
                                    </form>
                                    <br>
                                    <div class="panel panel-default">
                                    </div>
                                </div>
                                <!-- The blueimp Gallery widget -->
                                <div id="blueimp-gallery" class="blueimp-gallery blueimp-gallery-controls"
                                     data-filter=":even">
                                    <div class="slides"></div>
                                    <h3 class="title"></h3>
                                    <a class="prev">‹</a>
                                    <a class="next">›</a>
                                    <a class="close">×</a>
                                    <a class="play-pause"></a>
                                    <ol class="indicator"></ol>
                                </div>
                            </div>
                        </div>
                    </div>



                </div>
            </div></div>
    #*<div class="div_frame" style="width: 600px">

        <div class="div_frame_2" style="width: 600px;margin-left: 115px">
            <a href="http://duty.oss-cn-shenzhen.aliyuncs.com/35ad2338-e5fe-41ab-9d6b-d55eb3b554a4banner.png"   style="display: none" data-gallery></a>
            <div class="div_left_img"><a href="http://duty.oss-cn-shenzhen.aliyuncs.com/35ad2338-e5fe-41ab-9d6b-d55eb3b554a4banner.png"    data-gallery>
                <img width="85%" height="85%" src="/admin/media/image/banner.png" align="center"></a><span style="display:block;width: 71%";>banner建议尺寸：750X1150，大小<500k</span></div>
            <a href="http://duty.oss-cn-shenzhen.aliyuncs.com/2891d643-da2b-44d2-a032-d57c641ac5abbanner_desc.png"  style="display: none"  data-gallery></a>

            <div class="div_right_img"><a href="http://duty.oss-cn-shenzhen.aliyuncs.com/2891d643-da2b-44d2-a032-d57c641ac5abbanner_desc.png"   data-gallery>
                <img width="81%" height="81%" src="/admin/media/image/banner_desc.png" align="center"></a><span style="display:block";>弹窗提示文字内容</span></div>
        </div>


       </div>*#
        <div class="div_frame" style="margin-top: 40px">
            <div ReadOnly="true" class="div_frame_1">下载bar：
        </div>

            <div class="div_frame_2" style="margin-left: 16px">  <a href="javascript:;" class="a-upload">
                <input type="file" name="file" id="file" accept="image/gif, image/jpeg,image/png">上传
            </a> <a href="#"  id="image_delete" class="a-upload">
                <input type="button" />删除
            </a> <span style="display:inline-block ;height: 50px;color:gray;position: absolute;margin-top: 2px;margin-left: 5px">建议尺寸宽（1125）X高（158)；大小<50K</span><img id="banner_show" style="height:32px;margin-top:10px;margin-bottom:8px;display: none"  src="$!config.banner" > </div>
        </div>



<div class="div_frame">


    <div ReadOnly="true" class="div_frame_1">提示文字内容：
    </div>

    <div class="div_frame_2"> <textarea maxlength="56" rows="5" id="textarea_html_prompt"
                                         class=""
                                         style="border:1px solid;border-color:rgba(82,168,236,.8);width: 220px;resize: none;margin-left: 5px">$!config.bannerDesc</textarea><span style="display:inline-block ;height: 50px;color:gray;position: absolute;margin-top: 2px">（建议56个字符以内)</span></div>

</div>



        #*上传图片结束*#





            <div class="div_frame">


            </div>


            <div class="div_frame">

                <div ReadOnly="true" class="div_frame_1">下载地址：
                </div>

                <div class="div_frame_2"><input type="text" id="textarea_html_link"
                                                class="input-top" value="$!config.link"
                                                style="border:1px solid;border-color:rgba(82,168,236,.8);width: 220px;height: 30px;margin-left: 5px" onchange="linkJudge()"/> <span id="" style="color: grey;margin-left: 3px;">(地址规范"http://")</span> </div>


            </div>
        </div>
        <div class="div_right" >
            <div class="div_frame" style="width: 250px;margin-left: 0px">

                <div class="div_frame_2" style="width: 180px;margin-left: 0px;height: ">
                    <span style="display:block;width: 71%";>H5示例：</span>
                    <a href="http://duty.oss-cn-shenzhen.aliyuncs.com/f26d66ad-9d5c-4eb1-b079-8449109477afH5示例.png"   style="display: none" data-gallery></a>
                    <div class="div_left_img"><a href="http://duty.oss-cn-shenzhen.aliyuncs.com/f26d66ad-9d5c-4eb1-b079-8449109477afH5示例.png"    data-gallery>
                        <img width="52%" height="52%" src="/admin/media/image/H5_example.png" align="center"></a></div>
                </div></div>
            <div class="div_frame" style="width: 250px;margin-top: 0px ;margin-left: 0px" >
                <div class="div_frame_2" style="width: 180px;margin-left: 0px">
                    <span style="display:block";>弹框示例：</span>
                    <a href="http://duty.oss-cn-shenzhen.aliyuncs.com/3b762d1d-8321-43af-8e2a-a7c4faae14ecH5弹框示例.png"  style="display: none"  data-gallery></a>

                    <div class="div_right_img" ><a href="http://duty.oss-cn-shenzhen.aliyuncs.com/3b762d1d-8321-43af-8e2a-a7c4faae14ecH5弹框示例.png"   data-gallery>
                        <img width="55.5%" height="55.5%" src="/admin/media/image/H5_pop-up_example.png" align="center"></a></div>
                </div>


            </div>

        </div>

        </div>




    <input type="text" id="mission_id" style="display: none" value="$!id">
        #set($url = $formLink.setTarget('/mission/step3').addQueryData('id',"$!id").fork())
    <div style="height:40px;width:auto;clear: both ;text-align: center ;margin-bottom: 15px">
        <a href="#" id="removeStep2" class="btn gray search-btn" style="width: 80px;height: 37px">上一步</a>

        <a id="preview" class="btn gray search-btn" style="width: 80px;height: 37px;margin-left: 40px">预览</a>

        <a href="#" id="saveStep3" class="btn green search-btn" style="width: 80px;height: 37px;margin-left: 40px">提交</a>
    </div>


</div>



        <script type="text/javascript">
            function alertGlobalErrorCall(result) {
                var errorCode=result.code;
                var errorMap= $.getGlobalErrorMap();
                if(errorCode==224){
                    $.noPrivilege(result.data)
                    return;
                }
                if(errorCode==225){
                    $.stackTrace(result)
                    return;
                }

                if(errorMap[errorCode]!=null){
                    $.notify(errorMap[errorCode],"warn");
                } else {
                    $.notify("系统异常","warn");
                }
            }

                jQuery(document).ready(function () {

                    App.init();
                    UINestable.init();
                    #if($config)

                        $("#banner_show").attr("src","$config.banner");

                        $("#banner_show").css("display","block");

                    #end

                    var templateId = $('input:radio[name="template"]:checked').val();

                    #foreach($template in $!templateList)

                        if(templateId==$template.id){

                            var configMap ='$template.config';
                            var config  = JSON.parse(configMap);

                        }
                    #end

#if($!judge==1)
                    $("#title_desc").html("(建议"+config.titleSize+"字以内)")

#end



    });
#if($!judge==1)

//高亮侧边导航栏
$(function () {
    var localSearch = location.search.match(/r=([^&]+)/);
    if (!localSearch) {
        localSearch = {};
        localSearch[1] = 'index/index';
    }

    $(".page-sidebar-menu .sub-menu a").each(function () {
        var $trigger =
        $(this);
        var search = this.search.match(/r=([^&]+)/);
        if (search && ( search[1] == localSearch[1] )) {
                $trigger.parent().addClass( "active" );
                $trigger.parentsUntil( ".sub-menu" ).parent().parent().addClass( "active" );
        }
        return true;
    });
});

//选择多选操作框
$('.multi-to-action').on('click', function () {
    var box = $(this).parent();
    box.find('.multi-action-choice-box').css('display', 'block');
})


$('.multi-action-select-box').mouseleave(function () {
    $('.multi-action-choice-box').css('display', 'none');
})
$('.webuploader-pick').on('click', function () {

    $(this).attr("class", "webuploader-pick-hover");

})


function linkJudge()
{
    var str = $('#textarea_html_link').val();
    var strs=str.substring(0,4);

    if (!strs.equals("http")||!strs.equals("HTTP")){
        alertMessage("请按要求输入！");
        $('#textarea_html_link').val("")
        return;
    }
}
function  upperCase(){
    var count = $("#wrap a").length/2;
    var templateId = $('input:radio[name="template"]:checked').val();

    #foreach($template in $!templateList)

        if(templateId==$template.id){

            var configMap ='$template.config';
            var config  = JSON.parse(configMap);

        }
    #end

    if(count>=config.picListSize){
        alert("超出图片张数限制！")
        return;
    }


    setTimeout(upload, 500);

}
function upload(){

    $("#123").click();
}


</script>
<script type="text/javascript">
function  titleJudge(){
    var count = $('#textarea_html_title').val().length;
    var templateId = $('input:radio[name="template"]:checked').val();

    #foreach($template in $!templateList)

        if(templateId==$template.id){

            var configMap ='$template.config';
            var config  = JSON.parse(configMap);

        }
    #end

    if(count>=config.titleSize){
        alert("标题图片超过字数！")
        return;
    }}
$('#file').on('change' , function(){

    if(!this.value || this.value.indexOf('.jpg') == -1){
        return false;
    }
});

//初始化上传插件
$('#file').fileupload({
    autoUpload : true, //这里为true，则选中文件后就会自动上传
    type: "POST",
    async: false,
    cache: false,
    contentType: false,
    processData: false,
    url: '/pic/templateBannerPic',
    sequentialUploads: true,
    fail : function (msg) {
        alert("上传失败，请重新上传！");
    }
}).bind('fileuploadprogress', function (e, data) {


    $("#banner_show").css("display", "block");

    $("#banner_show").attr("src", "/admin/media/image/loading2.gif");

}).bind('fileuploaddone', function (e, data) {
    if (!data.result.success) {

        alertErrorCall(data.result.code);

        $("#banner_show").attr("src", "");
        $("#banner_show").css("display", "none");

        return;
    }
    if(data.result.code==200){
        $("#banner_show").attr("src",data.result.data);
        $("#banner_show").css("display","block");
    }


})
$("#image_delete").on("click",function(){
    $("#banner_show").css("display","none");
    $("#banner_show").attr("src","");
    $("#file").val("");
})




//提交页面操作
$("#saveStep3").on("click", function () {
    var id = $("#mission_id").val();
    var templateId = $('input:radio[name="template"]:checked').val();
    var htmlTitle = $('#textarea_html_title').val()
    var htmlImages = "";
    $('#wrap a').each(function(){
        if($(this).data("id")==1){
            if($(this).attr('href')==""){
                alert("请确定HTML5模板Banner图片已经上传成功!");
                throw SyntaxError();
            }
            htmlImages = htmlImages +"&"+$(this).attr('href')

        }

    });
    htmlImages = htmlImages.substring(1);
    var bannerImage = $('#banner_show').attr('src');
    var prompt = $('#textarea_html_prompt').val();
    var link = $('#textarea_html_link').val();
    if(htmlTitle==""){
        window.alertErrorCall("500");
        return;
    }
    if(bannerImage==""||prompt==""||link==""||htmlImages==""){
        window.alertErrorCall("499");
        return;
    }

    var configMap={
        'title':htmlTitle,
        'picList':htmlImages,
        'banner':bannerImage,
        'bannerDesc':prompt,
        'link':link,
    };

    var config=JSON.stringify(configMap);

    $.ajax({
        type: 'POST',
        url: 'missionDefineCreateStep3',
        data: {
            "id": id,
            "templateId": templateId,
            "config": config,
        },
        success: function (data) {
            if(data.success == true){
                checkAll();


            }else{
                alertGlobalErrorCall(data);
            }

        },
    });

})
    function checkAll(){

        var id = $("#mission_id").val();
        $.ajax({
            type: 'POST',
            url: 'checkMission',
            data: {
                "id": id,
            },
            success: function (data) {


                if(data.success == true){

                    var promptList = data.data;
                    $.each( promptList, function( index, ele ) {
                        alertMessage(ele);
                    });


                    if(promptList.length<1){
                        window.location.href = '/mission/missionMainIndex';}
                }else{
                    alertGlobalErrorCall(data);
                }

            },
        });

    }
$("#preview").on("click", function () {
    var id = $("#mission_id").val();
    var templateId = $('input:radio[name="template"]:checked').val();
    var htmlTitle = $('#textarea_html_title').val()
    var htmlImages = "";
    $('#wrap a').each(function(){
        if($(this).data("id")==1){
            if($(this).attr('href')==""){
                alert("请确定HTML5模板Banner图片已经上传成功!");
                throw SyntaxError();
            }
            htmlImages = htmlImages +"&"+$(this).attr('href')

        }

    });
    htmlImages = htmlImages.substring(1);
    var bannerImage = $('#banner_show').attr('src');
    var prompt = $('#textarea_html_prompt').val();
    var link = $('#textarea_html_link').val();
    if(htmlTitle==""){
        window.alertErrorCall("500");
        return;
    }
    if(bannerImage==""||prompt==""||link==""||htmlImages==""){
        window.alertErrorCall("499");
        return;
    }

    var configMap={
        'title':htmlTitle,
        'picList':htmlImages,
        'banner':bannerImage,
        'bannerDesc':prompt,
        'link':link,
    };

    var config=JSON.stringify(configMap);

    $.ajax({
        type: 'POST',
        url: 'missionDefineCreateStep3',
        data: {
            "id": id,
            "templateId": templateId,
            "config": config,
        },
        success: function (data) {
            if(data.success == true){
                window.location.href ="/mission/getMissionQRCode?id=$!id&url=$!url";

            }else{
                alertGlobalErrorCall(data);
            }

        },
    });

})
    #else




    function linkJudge()
    {
        alertMessage("所有模板被禁用，请联系管理员。")
    }
    function  upperCase(){
        alertMessage("所有模板被禁用，请联系管理员。")

    }
    function upload(){

        alertMessage("所有模板被禁用，请联系管理员。")
    }


    </script>
    <script type="text/javascript">
    function  titleJudge(){
        alertMessage("所有模板被禁用，请联系管理员。")
        }
    $('#file').on('change' , function(){

        alertMessage("所有模板被禁用，请联系管理员。")
    });


    $("#image_delete").on("click",function(){
        alertMessage("所有模板被禁用，请联系管理员。")
    })




    //提交页面操作
    $("#saveStep3").on("click", function () {
        alertMessage("所有模板被禁用，请联系管理员。")
    })
    $("#preview").on("click", function () {
        alertMessage("所有模板被禁用，请联系管理员。")
    })
#end

    $("#removeStep2").on("click", function () {
        var id =  $("#mission_id").val();
        window.location.href = 'step2?id='+id
    })

    function alertErrorCall(errorCode) {
        seajs.use("$formLink/admin/form/script/exam/error.js", function (main) {
            var errorMap= main.getErrorMap();
            if(errorMap[errorCode]!=null){
                $.notify(errorMap[errorCode],"warn");
            } else {
                $.notify("系统异常","warn");
            }
        });
    }
    function alertMessage(message) {
        $.notify(message, "info");
    }


</script>
<script>

    window.onload = function(){

        document.getElementById('textarea_html_prompt').addEventListener('keydown',function(e){

            if(e.keyCode!=13) return;

            e.preventDefault();

            this.value += '';

        });

    };

</script>
